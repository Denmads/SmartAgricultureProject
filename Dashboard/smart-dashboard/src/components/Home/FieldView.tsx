import React, {ReactElement, FC, useRef, useEffect, useState} from "react";
import FieldInfo from '../../models/FieldInfoModel';
import {useQuery} from 'react-query';
import './FieldView.css';
import DroneInfo from "../../models/DroneInfoModel";
import {SvgIcon, Tooltip} from '@mui/material';

interface FieldViewProps {
    info: FieldInfo | undefined,
    drones: DroneInfo[];
}

const FieldView: FC<FieldViewProps> = (props: FieldViewProps): ReactElement => {

    const fieldRef = useRef<HTMLDivElement>(null);
    const [update, updateComp] = useState({});

    function calcDroneX(x: number, actualWidth: number, displayWidth: number): number {
        let percent = x / actualWidth;
        return percent * displayWidth;
    }

    function calcDroneY(y: number, actualHeight: number, displayHeight: number): number {
        let percent = y / actualHeight;
        return percent * displayHeight;
    }
    

    useEffect(() => {
        function onResize() {
            updateComp({});
        }

        window.addEventListener("resize", onResize);
        
        return () => {
            window.removeEventListener("resize", onResize);
        }
    }, [])    

    return (
        <div id="field" ref={fieldRef} style={{backgroundImage:"url(/field.png)", flexGrow: 1}}>
            {fieldRef.current && props.info && props.drones.map((d) => 
            <Tooltip disableFocusListener title={d.id} arrow>
                <SvgIcon key={d.id} sx={{position:"absolute", left:calcDroneX(d.x, props.info!.width, fieldRef.current!.clientWidth), top:calcDroneY(d.y, props.info!.height, fieldRef.current!.clientHeight)}}>
                    <path style={{stroke:"none", fillRule:"nonzero", fill:"rgb(0%,0%,0%)", fillOpacity: "1"}} d="M 6.964844 0.0195312 C 6.359375 0.175781 5.101562 1.308594 4.492188 2.242188 L 4.382812 2.410156 L 4.296875 2.359375 C 4.25 2.328125 4.148438 2.28125 4.070312 2.25 C 3.941406 2.207031 3.902344 2.199219 3.691406 2.199219 C 3.425781 2.199219 3.300781 2.226562 3.101562 2.332031 C 2.835938 2.46875 2.648438 2.671875 2.515625 2.957031 C 2.371094 3.265625 2.355469 3.605469 2.460938 3.929688 C 2.492188 4.023438 2.515625 4.105469 2.515625 4.105469 C 2.515625 4.109375 2.460938 4.148438 2.394531 4.1875 C 2.003906 4.425781 1.324219 5.03125 0.917969 5.5 C 0.101562 6.441406 -0.148438 7.160156 0.398438 7.003906 C 0.605469 6.945312 0.929688 6.753906 1.25 6.503906 C 1.824219 6.054688 2.5 5.335938 2.855469 4.789062 L 2.964844 4.621094 L 3.121094 4.703125 C 3.425781 4.859375 3.667969 4.875 4.089844 4.773438 C 4.117188 4.765625 4.179688 4.816406 4.347656 4.976562 C 5.644531 6.1875 6.863281 7.734375 7.714844 9.253906 L 7.832031 9.464844 L 7.71875 9.703125 C 7.363281 10.457031 7.234375 11.347656 7.367188 12.140625 C 7.425781 12.492188 7.5 12.757812 7.632812 13.105469 L 7.667969 13.199219 L 7.546875 13.457031 C 7.199219 14.203125 6.625 15.085938 5.859375 16.070312 C 5.363281 16.707031 4.746094 17.425781 4.226562 17.980469 L 4.054688 18.160156 L 3.902344 18.128906 C 3.613281 18.074219 3.28125 18.128906 3.054688 18.265625 C 3.050781 18.269531 3.019531 18.222656 2.988281 18.167969 C 2.734375 17.734375 1.910156 16.902344 1.257812 16.421875 C 0.792969 16.078125 0.316406 15.851562 0.132812 15.886719 C -0.15625 15.945312 0.0507812 16.433594 0.648438 17.113281 C 1.125 17.660156 1.902344 18.308594 2.429688 18.601562 L 2.601562 18.695312 L 2.539062 18.839844 C 2.449219 19.0625 2.421875 19.21875 2.429688 19.472656 C 2.4375 19.644531 2.449219 19.71875 2.484375 19.824219 C 2.609375 20.183594 2.839844 20.449219 3.15625 20.601562 C 3.332031 20.683594 3.5 20.722656 3.703125 20.722656 C 3.925781 20.722656 4.070312 20.691406 4.230469 20.605469 L 4.363281 20.539062 L 4.449219 20.660156 C 4.699219 21.015625 5.304688 21.648438 5.714844 21.988281 C 6.296875 22.46875 6.851562 22.777344 7.132812 22.777344 C 7.1875 22.777344 7.21875 22.765625 7.253906 22.730469 C 7.296875 22.6875 7.300781 22.671875 7.289062 22.582031 C 7.238281 22.058594 6.066406 20.8125 4.972656 20.117188 C 4.898438 20.066406 4.832031 20.019531 4.832031 20.015625 C 4.832031 20.003906 4.851562 19.960938 4.871094 19.914062 C 4.957031 19.707031 4.980469 19.421875 4.933594 19.152344 L 4.90625 19.003906 L 5.0625 18.828125 C 5.316406 18.539062 6.0625 17.777344 6.363281 17.496094 C 7.324219 16.609375 8.40625 15.789062 9.320312 15.257812 L 9.46875 15.171875 L 9.65625 15.261719 C 10 15.433594 10.363281 15.546875 10.78125 15.609375 C 11.03125 15.648438 11.574219 15.65625 11.824219 15.621094 C 12.230469 15.566406 12.640625 15.445312 12.992188 15.269531 L 13.199219 15.171875 L 13.433594 15.304688 C 14.265625 15.785156 15.316406 16.601562 16.40625 17.621094 C 16.746094 17.9375 17.394531 18.574219 17.644531 18.832031 L 17.867188 19.0625 L 17.847656 19.171875 C 17.820312 19.304688 17.820312 19.574219 17.84375 19.703125 C 17.855469 19.757812 17.890625 19.855469 17.917969 19.925781 C 17.949219 19.996094 17.96875 20.054688 17.96875 20.058594 C 17.964844 20.058594 17.875 20.125 17.769531 20.195312 C 17.515625 20.378906 17.25 20.605469 16.960938 20.902344 C 16.347656 21.539062 15.886719 22.167969 15.722656 22.601562 C 15.660156 22.753906 15.660156 22.914062 15.722656 22.964844 C 15.992188 23.195312 17.234375 22.21875 18.0625 21.117188 C 18.179688 20.964844 18.425781 20.589844 18.441406 20.546875 C 18.445312 20.535156 18.464844 20.539062 18.492188 20.558594 C 18.574219 20.613281 18.824219 20.695312 18.96875 20.714844 C 19.472656 20.789062 19.996094 20.496094 20.238281 20.015625 C 20.410156 19.683594 20.429688 19.324219 20.304688 18.9375 C 20.277344 18.851562 20.261719 18.777344 20.269531 18.773438 C 20.277344 18.769531 20.367188 18.710938 20.46875 18.640625 C 21.464844 17.960938 22.652344 16.503906 22.664062 15.957031 C 22.667969 15.871094 22.660156 15.847656 22.625 15.820312 C 22.316406 15.5625 20.921875 16.714844 20.089844 17.914062 C 20.011719 18.03125 19.921875 18.164062 19.898438 18.207031 C 19.875 18.25 19.847656 18.289062 19.839844 18.289062 C 19.832031 18.289062 19.773438 18.257812 19.707031 18.222656 C 19.457031 18.085938 19.105469 18.042969 18.839844 18.121094 L 18.714844 18.15625 L 18.542969 17.988281 C 18.3125 17.773438 17.796875 17.226562 17.535156 16.921875 C 16.578125 15.816406 15.78125 14.664062 15.1875 13.515625 L 15.023438 13.199219 L 15.0625 13.105469 C 15.140625 12.902344 15.257812 12.5 15.300781 12.289062 C 15.457031 11.488281 15.382812 10.664062 15.085938 9.898438 L 15.003906 9.683594 L 15.070312 9.558594 C 15.441406 8.859375 15.890625 8.195312 16.539062 7.390625 C 17.089844 6.710938 17.839844 5.878906 18.503906 5.214844 L 18.914062 4.800781 L 19.210938 4.796875 C 19.542969 4.792969 19.65625 4.765625 19.863281 4.636719 C 19.96875 4.570312 19.972656 4.566406 20 4.597656 C 20.011719 4.617188 20.078125 4.703125 20.144531 4.789062 C 20.394531 5.125 20.957031 5.667969 21.449219 6.054688 C 22.003906 6.488281 22.570312 6.789062 22.824219 6.789062 C 22.914062 6.789062 22.980469 6.753906 22.992188 6.703125 C 23.019531 6.605469 22.867188 6.332031 22.613281 6 C 22.421875 5.757812 21.855469 5.164062 21.621094 4.964844 C 21.21875 4.621094 20.75 4.285156 20.492188 4.148438 L 20.363281 4.082031 L 20.410156 3.945312 C 20.453125 3.824219 20.457031 3.785156 20.457031 3.535156 C 20.457031 3.28125 20.449219 3.242188 20.40625 3.105469 C 20.277344 2.699219 19.976562 2.394531 19.578125 2.25 C 19.449219 2.207031 19.40625 2.199219 19.191406 2.199219 C 18.976562 2.199219 18.929688 2.207031 18.796875 2.25 C 18.5625 2.328125 18.574219 2.328125 18.53125 2.257812 C 18.4375 2.105469 18.175781 1.789062 17.941406 1.546875 C 17.316406 0.902344 16.457031 0.277344 15.96875 0.121094 C 15.128906 -0.152344 15.59375 0.824219 16.808594 1.882812 C 17.199219 2.21875 17.808594 2.664062 18.027344 2.773438 L 18.09375 2.804688 L 18.039062 2.914062 C 17.90625 3.1875 17.867188 3.558594 17.941406 3.867188 L 17.976562 4.011719 L 17.507812 4.488281 C 17.253906 4.75 16.925781 5.070312 16.78125 5.199219 C 15.75 6.148438 14.617188 6.984375 13.460938 7.648438 L 13.148438 7.828125 L 12.9375 7.738281 C 12.421875 7.511719 11.992188 7.410156 11.464844 7.390625 C 10.964844 7.371094 10.542969 7.433594 10.050781 7.601562 L 9.792969 7.691406 L 9.457031 7.511719 C 8.242188 6.871094 6.769531 5.707031 5.105469 4.078125 L 4.90625 3.878906 L 4.933594 3.753906 C 4.976562 3.574219 4.960938 3.300781 4.898438 3.117188 C 4.871094 3.039062 4.847656 2.964844 4.839844 2.949219 C 4.832031 2.925781 4.863281 2.898438 4.953125 2.84375 C 5.265625 2.652344 5.800781 2.195312 6.203125 1.777344 C 7.152344 0.792969 7.554688 -0.136719 6.964844 0.0195312 Z M 19.324219 3.265625 C 19.429688 3.316406 19.484375 3.421875 19.472656 3.550781 C 19.464844 3.664062 19.425781 3.726562 19.332031 3.78125 C 19.152344 3.886719 18.914062 3.742188 18.917969 3.535156 C 18.917969 3.398438 18.988281 3.300781 19.113281 3.253906 C 19.207031 3.21875 19.238281 3.222656 19.324219 3.265625 Z M 3.851562 3.289062 C 3.882812 3.304688 3.929688 3.339844 3.960938 3.371094 C 4.109375 3.539062 3.960938 3.820312 3.722656 3.820312 C 3.582031 3.820312 3.464844 3.695312 3.460938 3.542969 C 3.460938 3.339844 3.660156 3.207031 3.851562 3.289062 Z M 3.890625 19.199219 C 3.96875 19.246094 4.023438 19.359375 4.023438 19.464844 C 4.023438 19.535156 4.015625 19.5625 3.960938 19.621094 C 3.882812 19.714844 3.816406 19.742188 3.699219 19.730469 C 3.5 19.710938 3.398438 19.492188 3.503906 19.296875 C 3.527344 19.246094 3.625 19.167969 3.675781 19.15625 C 3.730469 19.140625 3.832031 19.164062 3.890625 19.199219 Z M 19.273438 19.234375 C 19.363281 19.292969 19.414062 19.410156 19.398438 19.515625 C 19.378906 19.621094 19.257812 19.746094 19.160156 19.761719 C 19.023438 19.785156 18.898438 19.710938 18.851562 19.582031 C 18.820312 19.492188 18.824219 19.339844 18.867188 19.285156 C 18.953125 19.171875 19.136719 19.148438 19.273438 19.234375 Z M 19.273438 19.234375 "/>
                </SvgIcon>
            </Tooltip>)}
        </div>
    );
}

export default FieldView;